## Запустить локально через docker-compose:
```
git clone https://github.com/sa-ivannikov/tasks_api
docker-compose up -d
docker-compose exec web python3 manage.py db init
docker-compose exec web python3 manage.py db migrate
docker-compose exec web python3 manage.py db upgrade
```
Файлы с переменными окружения оставил специально для упрощения запуска. 

## API пользователей

### Регистрация:
Нужно отправить POST с парой **username** и **password** в JSON-формате на эндпоинт
**/api/users/register**. В ответ придет JSON с токеном, а в БД запишется пновый пользователь. **username** уникален и API не примет уже существующий. 
### Логин:
Отправляем POST с парой **username** и **password** зарегистрированного пользователя на эндпоинт  **/api/users/login**. В ответ также получаем JWT.

## API задач

Доступ к задачам есть только если в header'е Authorization указан верный и не просроченный JWT.
Пользователь на всех эндпоинтах имеет доступ только к тем задачам, которые были созданы им. Для этого в таблице с задачами есть поле **owner** - отношение с таблицей с пользователями. Каждый запрос к таблице с задачами использует фильтр по **owner**, значение берется из контекста приложения - **flask.g**, куда оно попадает при проверке токена.

### Получить все задачи
Отправляем GET на эндпоинт **/api/tasks**. В ответ получаем JSON со всеми задачами текущего пользователя.

### Получить задачу по id
Отправляем GET на эндпоинт **/api/tasks/<id>**, получаем задачу, если она создана текущим пользователем. Если задачи с таким ID нет, или она есть у другого пользователя, получаем соответствующий ответ. 

### Создать новую задачу
Отправляем POST запрос на эндпоинт **/api/tasks/new** c данными задачи в JSON-формате. Поля:
- title - Имя задачи. Обязательное.
- description - Описание задачи. Обязательное.
- state - Статус задачи. Может быть один из 4 вариантов: 'Новая', 'Запланированная', 'в Работе','Завершённая'. Если не указано, то примет значение 'Новая'. В других случаях будет ошибка.
Реализовано с помощью типа Enum в SQLAlchemy, в Postgres перечиляемый тип в таблице. 
- due - Дата и время выполнения задача, не обязательное поле. Формат DateTime.
- created_at - Дата и время создания задачи. Автоматически выбирается время на момент создания задачи. Пользователем не указывается.
- onwer - ID создателя задачи. Не указывается пользователем, создается автоматически.

### Редактировать существующую задачу по ID
Отправляем PUT на эндпоинт **/api/tasks/<id>** c данными задачи в формате JSON. Изменять можно только **title, description, state, due**

### Получение списка задач с фильтрацией по статусу и сроку выполнения
Отправляем GET запрос на эндпоинт **/api/tasks/filter**. В теле запроса в JSON формате указываем параметры фильтрации. 
Есть три параметра: 
- state - выбираем статус.
- due_max - максимальный в выборке срок выполнения задачи.
- due_min - минимально возможный в выборке срок выполнения задачи.
Можно указать любое кол-во из указанных параметров.
Пример тела:
```
{
    "due_min": "2019-05-06T14:01:26.035669", 
    "due_max": "2021-05-06T14:01:26.035669",
    "state":"Запланированная"

}
``````

